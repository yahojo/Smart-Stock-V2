name: Daily Stock Scan (智慧選股自動排程)

# --- 觸發條件 ---
on:
  schedule:
    # 設定每天自動執行時間
    # GitHub 使用 UTC 時間，台灣是 UTC+8
    # 所以 UTC 06:00 = 台灣時間 下午 14:00
    - cron: "0 6 * * *"

  # 允許手動按按鈕觸發 (方便您測試用)
  workflow_dispatch:

# --- 權限設定 (允許機器人修改網頁內容) ---
permissions:
  contents: write

# --- 工作流程 ---
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. 把程式碼抓下來
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. 設定 Python 環境 (為了跑 scan_stocks.py)
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # 3. 安裝 Python 套件
      - name: Install Python Dependencies
        run: |
          pip install yfinance pandas

      # 4. 執行掃描腳本 (這一步會產生 public/data.json)
      - name: Run Scan Script
        run: |
          python scan_stocks.py

      # 5. 設定 Node.js 環境 (為了打包 React 網頁)
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      # 6. 安裝前端套件
      - name: Install Node Dependencies
        run: npm install

      # 7. 打包網頁 (Build)
      - name: Build React App
        run: npm run build

      # 8. 發布到 GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build

